cmake_minimum_required (VERSION 2.8)
project (F6ACM)
INCLUDE(ExternalProject)



IF (NOT DEFINED ACM_ROOT)
IF (NOT DEFINED $ENV{ACM_ROOT})
SET (ENV{ACM_ROOT} "${F6ACM_SOURCE_DIR}/ACM-I")
ENDIF()
set(ACM_ROOT $ENV{ACM_ROOT})
ENDIF()

IF (NOT DEFINED MBSHM_ROOT)
IF (NOT DEFINED $ENV{MBSHM_ROOT})
SET (ENV{MBSHM_ROOT} "${F6ACM_SOURCE_DIR}/ACM-I")
ENDIF()
set(MBSHM_ROOT $ENV{MBSHM_ROOT})
ENDIF()

IF (NOT DEFINED ACM_SRC)
IF (NOT DEFINED $ENV{ACM_SRC})
SET (ENV{ACM_SRC} "${F6ACM_SOURCE_DIR}/ACM-src")
ENDIF()
set(ACM_SRC $ENV{ACM_SRC})
ENDIF()


IF (NOT DEFINED ACE_ROOT)
IF (NOT DEFINED $ENV{ACE_ROOT})
SET (ENV{ACE_ROOT} "${F6ACM_SOURCE_DIR}/DOC_ROOT/ACE")
ENDIF()
set(ACE_ROOT $ENV{ACE_ROOT})
ENDIF()

IF (NOT DEFINED MPC_ROOT)
IF (NOT DEFINED $ENV{MPC_ROOT})
SET (ENV{MPC_ROOT} "${F6ACM_SOURCE_DIR}/DOC_ROOT/MPC")
ENDIF()
set(MPC_ROOT $ENV{MPC_ROOT})
ENDIF()

IF (NOT DEFINED TAO_ROOT)
IF (NOT DEFINED $ENV{TAO_ROOT})
SET (ENV{TAO_ROOT} "${F6ACM_SOURCE_DIR}/DOC_ROOT/TAO")
ENDIF()
set(TAO_ROOT $ENV{TAO_ROOT})
ENDIF()

IF (NOT DEFINED CIAO_ROOT)
IF (NOT DEFINED $ENV{CIAO_ROOT})
SET (ENV{CIAO_ROOT} "${F6ACM_SOURCE_DIR}/DOC_ROOT/CIAO")
ENDIF()
set(CIAO_ROOT $ENV{CIAO_ROOT})
ENDIF()

IF (NOT DEFINED DDS_ROOT)
IF (NOT DEFINED $ENV{DDS_ROOT})
SET (ENV{DDS_ROOT} "${F6ACM_SOURCE_DIR}/DOC_ROOT/DDS")
ENDIF()
set(DDS_ROOT $ENV{DDS_ROOT})
ENDIF()

set(ENV{PATH} "$ENV{PATH}:${MBSHM_ROOT}/bin:${ACE_ROOT}/bin:${DDS_ROOT}/bin")
set(ENV{LD_LIBRARY_PATH} "$ENV{LD_LIBRARY_PATH}:${MBSHM_ROOT}/lib:${ACE_ROOT}/lib:${DDS_ROOT}/lib")



set(proj_ciao_acm CIAO_ACM)
ExternalProject_Add(${proj_ciao_acm}
  SOURCE_DIR ${CIAO_ROOT}
  CONFIGURE_COMMAND ${ACE_ROOT}/bin/mwc.pl -type gnuace CIAO_TAO.mwc 
  BUILD_COMMAND  $(MAKE)
  BUILD_IN_SOURCE 1
  INSTALL_COMMAND ""
)
set_property(TARGET ${proj_ciao_acm} PROPERTY FOLDER "${proj_ciao_acm}")

set(proj_dds_acm DDS_ACM)
ExternalProject_Add(${proj_dds_acm}
  SOURCE_DIR ${DDS_ROOT}
  CONFIGURE_COMMAND ${ACE_ROOT}/bin/mwc.pl -type gnuace DDS_no_tests.mwc 
  BUILD_COMMAND  $(MAKE)
  BUILD_IN_SOURCE 1
  INSTALL_COMMAND ""
  DEPENDS ${proj_ciao_acm}
)
set_property(TARGET ${proj_dds_acm} PROPERTY FOLDER "${proj_dds_acm}")

set(acm_build_args -DBUILD_EXTERNALS=0;-DCMAKE_INSTALL_PREFIX=${ACM_ROOT}) 
set(proj_acm_build ACM_BUILD)
ExternalProject_Add(${proj_acm_build}
  SOURCE_DIR ${ACM_SRC}
  INSTALL_DIR ${ACM_ROOT}
  CMAKE_ARGS ${acm_build_args}
  BUILD_COMMAND  $(MAKE)
  BUILD_IN_SOURCE 1
  INSTALL_COMMAND $(MAKE) install
  DEPENDS ${proj_dds_acm}
)
set_property(TARGET ${proj_acm_build} PROPERTY FOLDER "${proj_acm_build}")
